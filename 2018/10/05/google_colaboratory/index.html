<!DOCTYPE html>
<html lang=" en ">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Tzeny's demesne - Engineering and travelling</title>
<meta http-equip="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Google Colaboratory">
<meta name="keywords" content="Google Colaboratory, Tzeny's demesne, wikimisc">
<link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
<meta content="Tzeny's demesne" property="og:site_name">
<meta content="Google Colaboratory" property="og:title">
<meta content="article" property="og:type">
<meta content="A small corner of the internet dedicated to tutorials, resources and galleries created by me" property="og:description">
<meta content="https://tzeny.com/2018/10/05/google_colaboratory/" property="og:url">
<meta content="2018-10-05T00:00:00+00:00" property="article:published_time">
<meta content="https://tzeny.com/about/" property="article:author">
<meta content="wikimisc" property="article:section">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:title" content="Google Colaboratory">
<meta content="Tzeny's demesne" property="og:site_name">
<meta name="twitter:url" content="https://tzeny.com/2018/10/05/google_colaboratory/">
<meta name="twitter:description" content="A small corner of the internet dedicated to tutorials, resources and galleries created by me">
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/custom-style.css">
<link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
<link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/assets/lightbox2/dist/css/lightbox.min.css">
<link rel="icon" href="https://tzeny.com/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10302687-11"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-10302687-11'); </script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.1.1/katex.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.1.1/katex.min.js"></script>
</head>
<body>
<div class="container-fluid">
<header><div class="col-lg-12"><div class="row"><nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Tzeny's demesne</a><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav">
<li class="nav-item"> <a class="nav-link" href="https://tzeny.com/about">About/Contact Me</a>
</li>
<li class="nav-item"> <a class="nav-link" href="https://tzeny.com/blog">Blog</a>
</li>
<li class="nav-item"> <a class="nav-link" href="https://tzeny.com/wiki">Wiki</a>
</li>
<li class="nav-item"> <a class="nav-link" href="https://tzeny.com/gallery">Galleries</a>
</li>
</ul></div>
<ul class="nav justify-content-end"><li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox">
</li></ul></nav></div></div></header><div class="col-lg-12">
<div class="col-lg-12"><nav aria-label="breadcrumb" role="navigation"><ol class="breadcrumb">
<li class="breadcrumb-item"> <a href="https://tzeny.com"><i class="fa fa-home" aria-hidden="true"></i></a>
</li>
<li class="breadcrumb-item"> <a href="https://tzeny.com/wiki">Wiki</a>
</li>
<li class="breadcrumb-item active" aria-current="page"><a href="/2018/10/05/google_colaboratory/">Google Colaboratory</a></li>
</ol></nav></div>
<div class="row" id="blog-post-container">
<div class="col-lg-3"><div class="card">
<div class="card-header">Navigation</div>
<div class="card-body text-dark"> <a href="/2019/05/15/main_page/">Main Page</a><br> <a href="/2018/06/21/data_engineering/">Data Engineering</a><br> <a href="/wiki/categories/wikiprojects">Category: Projects</a><br> <a href="/wiki/categories/wikitools">Category: Tools</a><br> <a href="/2019/02/28/mathematics/">Mathematics</a><br> <a href="/2018/06/29/algorithms/">Algorithms</a><br> <a href="/2019/01/21/learning/">Learning</a><br> <a href="/wiki/categories/wikiastronomy">Astronomy</a><br> <a href="/2019/05/15/mediawiki/">Media Wiki Tutorials</a><br> <a href="/2019/05/15/homelab/">Homelab</a>
</div>
<div class="card-header">Useful</div>
<div class="card-body text-dark"> <a href="https://zbib.org/" target="_blank">Online Citation Generator</a><br> <a href="https://pandoc.org/try/" target="_blank">Pandoc format converter</a><br> <a href="/2018/06/25/examples/">Code Snippets</a><br> <a href="/2018/10/05/google_colaboratory/">Google Colaboratory</a><br> <a href="/2018/07/03/interesting_miscellaneous/">Interesting Misc</a>
</div>
</div></div>
<div class="col-lg-9"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"><div class="card-header">
<h1 class="post-title" itemprop="name headline">Google Colaboratory</h1>
<h4 class="post-meta"></h4>
</div>
<div class="card-body" itemprop="articleBody">
<p><a href="https://colab.research.google.com/">Colaboratory</a> is a Google research project created to help disseminate machine learning education and research. It’s a Jupyter notebook environment that requires no setup to use and runs entirely in the cloud. This means that as long as you have a Google account, you can freely train your models on a K80 GPU.</p>
<p>When you log in and connect to the Colaboratory runtime, you will get your own virtual machine with a K80 GPU (not always entirely yours, read below) and a Jupyter notebook environment. You can use it to your heart’s content for up to 12 hours. Or until you close your browser window. Be warned, sometimes the runtime can disconnect randomly.</p>
<p>For more information check out the <a href="https://research.google.com/colaboratory/faq.html">Google Colaboratory FAQ</a></p>
<h1 id="tips-and-tricks">Tips and tricks</h1>
<ul>
<li>Notebook stuck on initializing: click on ‘Runtime’ tab, click on ‘Restart runtime…’ 1</li>
<li>If you start a line in Jupyter Notebook with ‘!’, the line will execute as a command on the virtual machine supporting the runtime. Example: !pwd</li>
</ul>
<h2 id="getting-your-own-gpu2">Getting your own GPU2:</h2>
<p>So, if you want to use Google Colaboratory you should be aware that you may end up being not so lucky and share a K80 with somebody else. The main disadvantage of this is that you won’t have the full RAM of the GPU available and Tensorflow might throw out of resources exceptions. To see how much ram you have available run this script.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">ln</span> <span class="o">-</span><span class="n">sf</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">gputil</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">psutil</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">humanize</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">humanize</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">GPUtil</span> <span class="k">as</span> <span class="n">GPU</span>
<span class="n">GPUs</span> <span class="o">=</span> <span class="n">GPU</span><span class="p">.</span><span class="n">getGPUs</span><span class="p">()</span>
<span class="c1"># XXX: only one GPU on Colab and isn’t guaranteed
</span><span class="n">gpu</span> <span class="o">=</span> <span class="n">GPUs0</span>
<span class="k">def</span> <span class="nf">printm</span><span class="p">():</span>
 <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="p">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getpid</span><span class="p">())</span>
 <span class="k">print</span><span class="p">(</span><span class="s">"Gen RAM Free: "</span> <span class="o">+</span> <span class="n">humanize</span><span class="p">.</span><span class="n">naturalsize</span><span class="p">(</span> <span class="n">psutil</span><span class="p">.</span><span class="n">virtual_memory</span><span class="p">().</span><span class="n">available</span> <span class="p">),</span> <span class="s">" | Proc size: "</span> <span class="o">+</span> <span class="n">humanize</span><span class="p">.</span><span class="n">naturalsize</span><span class="p">(</span> <span class="n">process</span><span class="p">.</span><span class="n">memory_info</span><span class="p">().</span><span class="n">rss</span><span class="p">))</span>
 <span class="k">print</span><span class="p">(</span><span class="s">"GPU RAM Free: {0:.0f}MB | Used: {1:.0f}MB | Util {2:3.0f}% | Total {3:.0f}MB"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gpu</span><span class="p">.</span><span class="n">memoryFree</span><span class="p">,</span> <span class="n">gpu</span><span class="p">.</span><span class="n">memoryUsed</span><span class="p">,</span> <span class="n">gpu</span><span class="p">.</span><span class="n">memoryUtil</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">gpu</span><span class="p">.</span><span class="n">memoryTotal</span><span class="p">))</span>
<span class="n">printm</span><span class="p">()</span>
</code></pre></div></div>
<p>If you’re lucky and you get access to the full card you’ll see something like this:</p>
<p><code class="highlighter-rouge"> Gen RAM Free: 11.6 GB  | Proc size: 666.0 MB</code> <code class="highlighter-rouge"> GPU RAM Free: 11439MB | Used: 0MB | Util  0% | Total 11439MB</code></p>
<p>If you see RAM usage, that means that you are sharing the card with someone. Since by default Tensorflow allocates almost 100% of the GPU’s memory this is a problem. To get a new instance and a new chance to get you own GPU, run the following command in a cell:</p>
<p><code class="highlighter-rouge"> !kill -9 -1</code></p>
<p>Then wait 30-60 seconds and reconnect and check with the above script if you got your own GPU.</p>
<h2 id="making-sure-youre-training-on-the-gpu3">Making sure you’re training on the GPU3</h2>
<p>This code trains a sample model on the GPU.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/gpu:0'</span><span class="p">):</span>
  <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<h1 id="file-transfer-to-google-colaboratory">File transfer to Google Colaboratory</h1>
<p>Although the first method described below seems more involved, I think it’s the best one as I have had problems with the second method in the past.</p>
<h2 id="mounting-a-google-drive-folder-inside-your-jupyter-noteook4">Mounting a Google Drive folder inside your Jupyter Noteook4</h2>
<p>Mount your Google Drive inside the Notebook.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/gdrive'</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">symlink</span><span class="p">(</span><span class="s">'/gdrive/My Drive'</span><span class="p">,</span> <span class="s">'my_drive'</span><span class="p">)</span>

<span class="err">!</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="n">my_drive</span>
</code></pre></div></div>
<h2 id="saving-data5-using-the-google-colaboratory-python-library">Saving Data5 using the Google Colaboratory Python library</h2>
<p>To download data you can also use the files library provided by Google.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">model_from_json</span>

<span class="c1">#save model and weights
</span><span class="n">model_json</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"model.json"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">model_json</span><span class="p">)</span>
<span class="c1"># serialize weights to HDF5
</span><span class="n">model</span><span class="p">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s">"model.h5"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Saved model to disk"</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="n">files</span><span class="p">.</span><span class="n">download</span><span class="p">(</span><span class="s">'model.json'</span><span class="p">)</span>
<span class="n">files</span><span class="p">.</span><span class="n">download</span><span class="p">(</span><span class="s">'model.h5'</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="loading-data6-using-the-google-colaboratory-python-library">Loading Data6 using the Google Colaboratory Python library</h2>
<p>You can also upload your own files using the same library.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="n">uploaded</span> <span class="o">=</span> <span class="n">files</span><span class="p">.</span><span class="n">upload</span><span class="p">()</span>

<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">uploaded</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'User uploaded file "{name}" with length {length} bytes'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
      <span class="n">name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">uploaded</span><span class="p">[</span><span class="n">fn</span><span class="p">])))</span>

<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">model_from_json</span>

<span class="c1"># load model and weights
</span><span class="n">json_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'model.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="n">loaded_model_json</span> <span class="o">=</span> <span class="n">json_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">json_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">model_from_json</span><span class="p">(</span><span class="n">loaded_model_json</span><span class="p">)</span>
<span class="c1">#load weights
</span><span class="n">loaded_model</span><span class="p">.</span><span class="n">load_weights</span><span class="p">(</span><span class="s">"model.h5"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Loaded model from disk"</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">loaded_model</span>
<span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
</code></pre></div></div>
<ol>
<li><p><a href="https://stackoverflow.com/questions/49090430/notebook-stuck-on-initializing-when-using-gpu-backend">https://stackoverflow.com/questions/49090430/notebook-stuck-on-initializing-when-using-gpu-backend</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/48750199/google-colaboratory-misleading-information-about-its-gpu-only-5-ram-available">https://stackoverflow.com/questions/48750199/google-colaboratory-misleading-information-about-its-gpu-only-5-ram-available</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/40690598/can-keras-with-tensorflow-backend-be-forced-to-use-cpu-or-gpu-at-will">https://stackoverflow.com/questions/40690598/can-keras-with-tensorflow-backend-be-forced-to-use-cpu-or-gpu-at-will</a></p></li>
<li><p><a href="https://github.com/googlecolab/colabtools/issues/276">https://github.com/googlecolab/colabtools/issues/276</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/50166987/how-to-download-tensorflow-trained-model-on-google-colab">https://stackoverflow.com/questions/50166987/how-to-download-tensorflow-trained-model-on-google-colab</a></p></li>
<li><p><a href="https://colab.research.google.com/notebooks/io.ipynb#scrollTo=vz-jH8T_Uk2c">https://colab.research.google.com/notebooks/io.ipynb#scrollTo=vz-jH8T_Uk2c</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div></article></div>
</div>
</div>
</div>
<footer><p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>. Subscribe via <a href="/feed.xml%20">RSS</a></p></footer><script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script src="/assets/js/mode-switcher.js"></script> <script src="/assets/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
</body>
</html>
